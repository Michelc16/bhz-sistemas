<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- SNIPPET (o que será inserido na página) -->
    <template id="s_guiabh_featured_carousel" name="GuiaBH - Carrossel de Destaques">
        <section class="s_guiabh_featured_carousel py-5"
                 data-snippet="s_guiabh_featured_carousel"
                 data-name="GuiaBH - Carrossel de Destaques"
                 data-categories="Events">
            <div class="container">
                <t t-set="Event" t-value="request.env['event.event'].sudo()"/>
                <t t-set="domain" t-value="[('show_on_public_agenda','=', True), ('is_featured','=', True)]"/>

                <t t-if="'active' in Event._fields">
                    <t t-set="domain" t-value="domain + [('active','=', True)]"/>
                </t>

                <t t-set="featured_events" t-value="Event.search(domain, limit=8, order='date_begin asc')"/>

                <!-- filtro de publicado (quando existir) -->
                <t t-if="'is_published' in Event._fields or 'website_published' in Event._fields">
                    <t t-set="featured_events"
                       t-value="featured_events.filtered(lambda e: (('is_published' in e._fields and e.is_published) or ('website_published' in e._fields and e.website_published)))"/>
                </t>

                <t t-if="featured_events">
                    <t t-set="carousel_id" t-value="'guiabh_featured_carousel_%s' % (request.env.uid or 0)"/>

                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2 class="h4 mb-0">Eventos em destaque</h2>
                        <div class="carousel-controls d-none d-md-flex gap-2">
                            <button class="btn btn-outline-secondary btn-sm"
                                    t-att-data-bs-target="'#%s' % carousel_id"
                                    data-bs-slide="prev">‹</button>
                            <button class="btn btn-outline-secondary btn-sm"
                                    t-att-data-bs-target="'#%s' % carousel_id"
                                    data-bs-slide="next">›</button>
                        </div>
                    </div>

                    <div class="carousel slide" data-bs-ride="carousel" t-att-id="carousel_id">
                        <div class="carousel-indicators">
                            <t t-foreach="featured_events" t-as="event" t-foreach-index="idx">
                                <button type="button"
                                        t-att-data-bs-target="'#%s' % carousel_id"
                                        t-att-data-bs-slide-to="idx"
                                        t-att-class="'active' if idx == 0 else ''"
                                        t-att-aria-current="'true' if idx == 0 else 'false'"
                                        t-att-aria-label="'Slide %s' % (idx + 1)"/>
                            </t>
                        </div>

                        <div class="carousel-inner">
                            <t t-foreach="featured_events" t-as="event" t-foreach-index="idx">
                                <div class="carousel-item" t-att-class="'active' if idx == 0 else ''">
                                    <t t-set="detail_url" t-value="'/agenda/event/%s' % event.id"/>
                                    <a class="carousel-card d-block text-decoration-none" t-att-href="detail_url">
                                        <t t-if="event.promo_cover_image">
                                            <img class="w-100 rounded-4"
                                                 t-att-src="'/web/image/event.event/%s/promo_cover_image' % event.id"
                                                 t-att-alt="event.name"/>
                                        </t>
                                        <t t-else="">
                                            <div class="guiabh-carousel-placeholder rounded-4 d-flex align-items-center justify-content-center">
                                                <span class="text-muted">Sem imagem disponível</span>
                                            </div>
                                        </t>

                                        <div class="carousel-caption text-start">
                                            <p class="small text-uppercase text-muted mb-1">
                                                <t t-esc="event.date_begin.strftime('%d/%m/%Y %H:%M') if event.date_begin else ''"/>
                                            </p>
                                            <h3 class="h5 mb-2"><t t-esc="event.name"/></h3>
                                            <p class="mb-0 text-decoration-underline">Ver detalhes</p>
                                        </div>
                                    </a>
                                </div>
                            </t>
                        </div>

                        <button class="carousel-control-prev d-md-none" type="button"
                                t-att-data-bs-target="'#%s' % carousel_id" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"/>
                            <span class="visually-hidden">Anterior</span>
                        </button>
                        <button class="carousel-control-next d-md-none" type="button"
                                t-att-data-bs-target="'#%s' % carousel_id" data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"/>
                            <span class="visually-hidden">Próximo</span>
                        </button>
                    </div>
                </t>
                <t t-else="">
                    <div class="alert alert-secondary mb-0 text-center">
                        Nenhum evento em destaque no momento.
                    </div>
                </t>
            </div>
        </section>
</template>

</odoo>
