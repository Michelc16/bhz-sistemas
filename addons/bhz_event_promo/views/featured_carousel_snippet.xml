<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- SNIPPET (o que será inserido na página) -->
    <template id="s_guiabh_featured_carousel" name="GuiaBH - Carrossel de Destaques">
        <section class="s_guiabh_featured_carousel py-5"
                 data-snippet="s_guiabh_featured_carousel"
                 data-name="GuiaBH - Carrossel de Destaques"
                 data-categories="Events">
            <div class="container">
                <t t-set="featured_events" t-value="request.env['event.event'].guiabh_get_featured_events(12)"/>
                <t t-set="items" t-value="list(enumerate(featured_events))"/>

                <t t-if="items">
                    <t t-set="snippet_key" t-value="request.env.context.get('snippet_key')"/>
                    <t t-set="carousel_id" t-value="'guiabh_featured_%s' % (snippet_key or request.env.uid or 0)"/>

                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2 class="h4 mb-0">Eventos em destaque</h2>
                        <div class="carousel-controls d-none d-md-flex gap-2" t-if="len(items) &gt; 1">
                            <button class="btn btn-outline-secondary btn-sm"
                                    t-att-data-bs-target="'#%s' % carousel_id"
                                    data-bs-slide="prev">
                                ‹
                            </button>
                            <button class="btn btn-outline-secondary btn-sm"
                                    t-att-data-bs-target="'#%s' % carousel_id"
                                    data-bs-slide="next">
                                ›
                            </button>
                        </div>
                    </div>

                    <div class="carousel slide" data-bs-ride="carousel" t-att-id="carousel_id">

                        <div class="carousel-indicators" t-if="len(items) &gt; 1">
                            <t t-foreach="items" t-as="it">
                                <t t-set="idx" t-value="it[0]"/>
                                <button type="button"
                                        t-att-data-bs-target="'#%s' % carousel_id"
                                        t-att-data-bs-slide-to="idx"
                                        t-att-class="'active' if idx == 0 else ''"
                                        t-att-aria-current="'true' if idx == 0 else 'false'"
                                        t-att-aria-label="'Slide %s' % (idx + 1)"/>
                            </t>
                        </div>

                        <div class="carousel-inner">
                            <t t-foreach="items" t-as="it">
                                <t t-set="idx" t-value="it[0]"/>
                                <t t-set="event" t-value="it[1]"/>

                                <div class="carousel-item" t-att-class="'active' if idx == 0 else ''">
                                    <t t-set="detail_url" t-value="'/agenda/event/%s' % event.id"/>
                                    <a class="carousel-card d-block text-decoration-none" t-att-href="detail_url">
                                        <t t-if="event.promo_cover_image">
                                            <img class="w-100 guiabh-slide-bg rounded-4"
                                                 t-att-src="'/web/image/event.event/%s/promo_cover_image' % event.id"
                                                 t-att-alt="event.name"/>
                                        </t>
                                        <t t-else="">
                                            <div class="guiabh-carousel-placeholder guiabh-slide-bg rounded-4 d-flex align-items-center justify-content-center">
                                                <span class="text-muted">Sem imagem disponível</span>
                                            </div>
                                        </t>

                                        <div class="carousel-caption text-start">
                                            <p class="small text-uppercase text-muted mb-1">
                                                <t t-esc="event.date_begin.strftime('%d/%m/%Y %H:%M') if event.date_begin else ''"/>
                                            </p>
                                            <h3 class="h5 mb-2"><t t-esc="event.name"/></h3>
                                            <p class="mb-0 text-decoration-underline">Ver detalhes</p>
                                        </div>
                                    </a>
                                </div>
                            </t>
                        </div>

                        <t t-if="len(items) &gt; 1">
                            <button class="carousel-control-prev" type="button"
                                    t-att-data-bs-target="'#%s' % carousel_id" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"/>
                                <span class="visually-hidden">Anterior</span>
                            </button>
                            <button class="carousel-control-next" type="button"
                                    t-att-data-bs-target="'#%s' % carousel_id" data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"/>
                                <span class="visually-hidden">Próximo</span>
                            </button>
                        </t>
                    </div>
                </t>

                <t t-else="">
                    <div class="alert alert-secondary mb-0 text-center">
                        Nenhum evento em destaque no momento.
                    </div>
                </t>
            </div>
        </section>
    </template>

    <!-- Alias para manter compatibilidade com o antigo XMLID -->
    <template id="guiabh_featured_carousel_snippet" name="GuiaBH - Carrossel de Destaques (Legacy)">
        <t t-call="bhz_event_promo.s_guiabh_featured_carousel"/>
    </template>

</odoo>
